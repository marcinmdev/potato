services:
  http:
    container_name: potato-http
    image: nginx:stable-alpine
    ports:
        - "80:80"
        - "443:443"
    volumes:
        - .:/var/www/potato
        - ./docker/http/site.conf:/etc/nginx/conf.d/site.conf
        - ./docker/http/snippets:/etc/nginx/conf.d/snippets
        - ./docker/http/certs:/etc/ssl/certs
  php:
    container_name: potato-php
    hostname: potato-php
    build:
        context: ./docker/php
        dockerfile: Dockerfile-php81
    volumes:
        - .:/var/www/potato
        - ./docker/data/home/www-data:/home/www-data
        - "$SSH_AUTH_SOCK:$SSH_AUTH_SOCK"
    working_dir: /var/www
    environment:
        - SSH_AUTH_SOCK=$SSH_AUTH_SOCK
  db:
    container_name: potato-db
    image: postgres:14-alpine
    environment:
      POSTGRES_DB: potato
      POSTGRES_PASSWORD: potato
      POSTGRES_USER: potato
    volumes:
       - ./docker/data/db:/var/lib/postgresql/data:rw
